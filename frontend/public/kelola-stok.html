<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kelola Stok - Infinity Cafe</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="./css/responsive-tables.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
</head>
<body data-page="inventory">
  <!-- Header -->
  <nav class="header">
    <div class="header-brand">
      <h1 class="header-title" id="navbar-title">Stock Management</h1>
      <p class="header-subtitle">Stephany</p>
    </div>
    <div class="header-menu">
      <button class="nav-btn" id="nav-dashboard">Dashboard</button>
      <button class="nav-btn" id="nav-menu">Menu Management</button>
      <button class="nav-btn active" id="nav-stok">Stock Management</button>
      <button class="nav-btn" id="nav-report">Reports</button>
    </div>
    <div class="header-right">
      <div class="kitchen-status-container">
        <label class="switch">
          <input type="checkbox" id="kitchen-toggle" checked>
          <span class="slider"></span>
        </label>
      </div>
    </div>
  </nav>

  <!-- Kitchen Off Banner -->
  <div id="kitchen-off-banner" class="kitchen-off-banner hidden">
      ðŸš« Dapur sedang OFF. Tidak dapat menerima/memproses pesanan.
  </div>

  <!-- Offline Banner -->
  <div id="offline-banner" class="offline-banner hidden">
      ðŸ”Œ Gagal ambil data. Cek koneksi.
  </div>

  <!-- Main Content -->
  <div class="main-container">
    <div class="content-area">
      <!-- Greeting Message -->
      <div class="greeting-message">
        <h2>Hi, John Doe, here's today's stock overview!</h2>
        <p class="greeting-date" id="greeting-date">Monday, 14th July 2025</p>
      </div>

      <!-- Tab Navigation -->
      <div class="tab-navigation">
        <button id="tab-inventory" class="tab-btn tab-active" onclick="switchTab('inventory')">INVENTORY</button>
        <button id="tab-audit-history" class="tab-btn tab-audit-history" onclick="switchTab('audit-history')">AUDIT HISTORY</button>
        <button class="add-order-btn" id="add-item-btn">ADD NEW ITEM</button>
      </div>

      

      <!-- Tab Content -->
      <div id="tab-content">
        <!-- Iventory Tab (Default) -->
        <div id="tab-inventory-content" class="tab-panel active">
          <!-- Inventory Overview Cards -->
          <div class="inventory-overview">
            <div class="overview-card total-items">
              <div class="card-icon total-items">
                <i class="fas fa-boxes icons-total-items"></i>
              </div>
              <div class="card-content">
                <h3>Total Items</h3>
                <p>Total items at inventory</p>
                <span class="card-number" id="total-items"></span>
              </div>
            </div>

            <div class="overview-card low-stock">
              <div class="card-icon low-stock">
                <i class="fa-solid fa-triangle-exclamation icons-low-stock"></i>
              </div>
              <div class="card-content">
                <h3>Low Stock</h3>
                <p>Running low</p>
                <span class="card-number" id="low-stock-items">15</span>
              </div>
            </div>

            <div class="overview-card critical">
              <div class="card-icon critical">
                <i class="fa-solid fa-circle-xmark icons-critical"></i>
              </div>
              <div class="card-content">
                <h3>Critical</h3>
                <p>Out of stock</p>
                <span class="card-number" id="critical-items">15</span>
              </div>
            </div>

            <!-- Quick Action Section -->
            <div class="quick-action-section">
              <div class="quick-action-header">
                <h3>Quick<br>Action</h3>
              </div>
              <div class="quick-action-buttons">
                <button class="add-stock-btn" id="add-stock-btn">
                  <i class="fas fa-boxes"></i>
                  RESTOCK
                </button>
                <!-- <button class="btn-secondary" id="history-btn" style="margin-left:8px;">
                  <i class="fas fa-clock"></i>
                  HISTORY
                </button> -->
                <!-- <button class="bulk-stock-btn" id="bulk-stock-btn">
                  <i class="fas fa-truck"></i>
                  UNIT CONVERTER
                </button> -->
              </div>
            </div>
          </div>

          <div class="table-container">
            <!-- Search and Filter Section -->
            <div class="search-filter-section">
              <div class="search-container">
                <i class="fa-solid fa-magnifying-glass search-icon"></i>
                <input type="text" id="inventory-search" placeholder="Search menu..." class="search-input">
              </div>
              <div class="filter-container">
                <button class="filter-btn" onclick="inventoryManager.toggleFilterStock()">
                  <i class="fas fa-filter"></i>
                  Filter
                </button>
                <div class="filter-dropdown" id="filter-dropdown">
                  <div class="filter-groups-wrapper">
                    <div class="filter-group">
                      <label>Sort by Name:</label>
                      <select id="sort-filter">
                        <option value="">Default</option>
                        <option value="a-z">A to Z</option>
                        <option value="z-a">Z to A</option>
                      </select>
                    </div>

                    <div class="filter-group">
                      <label>Status:</label>
                      <select id="status-filter">
                        <option value="">All Status</option>
                      </select>
                    </div>

                    <div class="filter-group">
                      <label>Category:</label>
                      <select id="category-filter">
                        <option value="">All Categories</option>
                      </select>
                    </div>
                    
                    <div class="filter-group">
                      <label>Unit:</label>
                      <select id="unit-filter">
                        <option value="">All Units</option>
                      </select>
                    </div>
                  </div>
                  
                  <div class="filter-actions">
                    <button class="apply-filter-btn" onclick="inventoryManager.applyStockFilter()">Apply</button>
                    <button class="clear-filter-btn" onclick="inventoryManager.clearStockFilter()">Clear</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Table Info -->
            <div class="table-info">
              <span id="inventory-table-info">Showing 0 of 0 entries</span>
            </div>

            <!-- Inventory Table -->
            <table id="inventory-table">
              <thead>
                <tr>
                  <th>NO</th>
                  <th>ITEM NAME</th>
                  <th>CATEGORY</th>
                  <th>CURRENT STOCK</th>
                  <th>UNIT</th>
                  <th>THRESHOLD</th>
                  <th>STATUS</th>
                  <th class="action-header">ACTION</th>
                </tr>
              </thead>
              <tbody id="inventory-tbody">
                <!-- Rows will be populated by kelola-stok.js -->
              </tbody>
            </table>

            <!-- Pagination -->
            <div class="pagination-container" id="pagination">
              <div class="pagination-info">
                <span id="pagination-info">Page 1 of 1</span>
              </div>
              <div class="pagination-controls">
                <button class="pagination-btn" id="prev-btn" onclick="inventoryManager.changeStockPage(-1)">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <div class="page-numbers" id="page-numbers">
                  <!-- Page numbers will be generated here -->
                </div>
                <button class="pagination-btn" id="next-btn" onclick="inventoryManager.changeStockPage(1)">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
              <div class="pagination-size">
                <label>Show:</label>
                <select id="entries-per-page" onchange="inventoryManager.changeStockPageSize()">
                  <option value="5">5</option>
                  <option value="10" selected>10</option>
                  <option value="25">25</option>
                  <option value="50">50</option>
                </select>
                <span>entries</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Audit History Tab -->
        <div id="tab-audit-history-content" class="tab-panel">
          <div class="table-container">
            <div class="search-filter-section">
              <div class="search-container">
                <i class="fa-solid fa-magnifying-glass search-icon"></i>
                <input type="text" id="audit-history-search" placeholder="Search by ingredient name, user, or notes..." class="search-input" onkeyup="inventoryManager.filterAuditHistory(this.value)">
              </div>
              <div class="filter-container">
                <button class="filter-btn" onclick="inventoryManager.toggleFilterAuditHistory()">
                  <i class="fas fa-filter"></i>
                  Filter
                </button>
                <div class="filter-dropdown" id="audit-history-filter-dropdown">
                  <div class="filter-groups-wrapper">
                    <div class="filter-group">
                      <label>Sort by Name:</label>
                      <select id="audit-sort-filter">
                        <option value="">Default</option>
                        <option value="a-z">A to Z</option>
                        <option value="z-a">Z to A</option>
                      </select>
                    </div>
                    
                    <div class="filter-group">
                      <label>Action Type:</label>
                      <select id="audit-action-filter">
                        <option value="">All Type</option>
                        <option value="consume">Consume</option>
                        <option value="rollback">Rollback</option>
                        <option value="restock">Restock</option>
                        <option value="edit_stock">Edit Stock</option>
                        <option value="edit_minimum">Edit Minimum</option>
                        <option value="make_availabe">Make Available</option>
                        <option value="make_unavailable">Make Unavailable</option>
                      </select>
                    </div>
                    
                    <div class="filter-group">
                      <label>Date Range:</label>
                      <select id="audit-date-filter">
                        <option value="">All Time</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="quarter">This Quarter</option>
                        <option value="year">This Year</option>
                      </select>
                    </div>
                    
                    <div class="filter-group">
                      <label>Performed By:</label>
                      <select id="audit-user-filter">
                        <option value="">All Users</option>
                        <!-- Will be populated dynamically -->
                      </select>
                    </div>
                  </div>
                  
                  <div class="filter-actions">
                    <button class="apply-filter-btn" onclick="inventoryManager.applyAuditHistoryFilter()">Apply</button>
                    <button class="clear-filter-btn" onclick="inventoryManager.clearAuditHistoryFilter()">Clear</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Table Info -->
            <div class="table-info">
              <span id="audit-history-table-info">Showing 0 of 0 entries</span>
            </div>

            <table id="audit-history-table">
              <thead>
                <tr>
                  <th>NO</th>
                  <th>ITEM NAME</th>
                  <th>ACTION TYPE</th>
                  <th>QUANTITY BEFORE</th>
                  <th>QUANTITY AFTER</th>
                  <th>QUANTITY CHANGES</th>
                  <th>PERFORMED BY</th>
                  <!-- <th>DATE</th> -->
                  <th class="action-header">ACTION</th>
                </tr>
              </thead>
              <tbody id="audit-history-tbody"></tbody>
            </table>

            <!-- Pagination for audit history -->
            <div class="pagination-container" id="audit-history-pagination">
              <div class="pagination-info">
                <span id="audit-history-pagination-info">Page 1 of 1</span>
              </div>
              <div class="pagination-controls">
                <button class="pagination-btn" id="audit-history-prev-btn" onclick="inventoryManager.changeAuditHistoryPage(-1)">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <div class="page-numbers" id="audit-history-page-numbers">

                </div>
                <button class="pagination-btn" id="audit-history-next-btn" onclick="inventoryManager.changeAuditHistoryPage(1)">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
              <div class="pagination-size">
                <label>Show:</label>
                <select id="audit-history-page-size" onchange="inventoryManager.changeAuditHistoryPageSize()">
                  <option value="5">5</option>
                  <option value="10" selected>10</option>
                  <option value="25">25</option>
                  <option value="50">50</option>
                </select>
                <span>entries</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- View Item Modal -->
  <div id="view-item-modal" class="modal hidden">
    <div class="modal-content view-modal">
      <button class="modal-close" id="close-view-modal">
        &times;
      </button>
      <h3 class="modal-title">Item Details</h3>
      <div class="view-content">
        <div class="view-item">
          <label>Item Name:</label>
          <span id="view-item-name"></span>
        </div>
        <div class="view-item">
          <label>Category:</label>
          <span id="view-item-category"></span>
        </div>
        <div class="view-item">
          <label>Current Stock:</label>
          <span id="view-item-current"></span>
        </div>
        <div class="view-item">
          <label>Unit:</label>
          <span id="view-item-unit"></span>
        </div>
        <div class="view-item">
          <label>Minimum Stock:</label>
          <span id="view-item-minimum"></span>
        </div>
        <div class="view-item">
          <label>Status:</label>
          <span id="view-item-status"></span>
        </div>
        <div class="view-item">
          <label>Availability:</label>
          <span id="view-item-availability"></span>
        </div>
      </div>
      <!-- <div class="modal-actions">
        <button class="modal-btn modal-btn-cancel" onclick="inventoryManager.closeModal('view-item-modal')">Close</button>
        <button class="modal-btn" onclick="inventoryManager.editItemFromView()">Edit</button>
      </div> -->
    </div>
  </div>

  <!-- View Audit History Modal -->
   <div id="view-audit-modal" class="modal hidden">
    <div class="modal-content view-modal">
      <button class="modal-close" onclick="inventoryManager.closeModal('view-audit-modal')">
        &times;
      </button>
      <h3 class="modal-title">Audit History Details</h3>
      <div class="view-content">
        <div class="view-item">
          <label>Ingredient Name:</label>
          <span id="view-audit-ingredient-name"></span>
        </div>
        <div class="view-item">
          <label>Action Type:</label>
          <span id="view-audit-action-type"></span>
        </div>
        <div class="view-item">
          <label>Quantity Before:</label>
          <span id="view-audit-quantity-before"></span>
        </div>
        <div class="view-item">
          <label>Quantity After:</label>
          <span id="view-audit-quantity-after"></span>
        </div>
        <div class="view-item">
          <label>Quantity Changes:</label>
          <span id="view-audit-quantity-changed"></span>
        </div>
        <div class="view-item">
          <label>Performed By:</label>
          <span id="view-audit-performed-by"></span>
        </div>
        <div class="view-item">
          <label>Notes:</label>
          <span id="view-audit-notes"></span>
        </div>
        <div class="view-item">
          <label>Created At:</label>
          <span id="view-audit-created-at"></span>
        </div>
        <div class="view-item">
          <label>Order ID:</label>
          <span id="view-audit-order-id"></span>
        </div>
      </div>
      <div class="modal-actions">
        <button class="modal-btn modal-btn-cancel" onclick="inventoryManager.closeModal('view-audit-modal')">Close</button>
      </div>
    </div>
  </div>

  <!-- Add/Edit Item Modal -->
  <div id="item-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modal-title">Add New Item</h3>
        <button class="modal-close" id="close-modal">&times;</button>
      </div>
      <form id="item-form">
        <div class="form-group">
          <label for="item-name">Item Name</label>
          <input type="text" id="item-name" name="name" required>
        </div>
        <div class="form-group">
          <label for="item-category">Category</label>
          <select id="item-category" name="category" required>
            <option value="">Select Category</option>
            <option value="ingredients">Ingredients</option>
            <option value="packaging">Packaging</option>
            <option value="coffee_flavors">Coffee Flavors</option>
            <option value="milk_shake_flavors">Milk Shake Flavors</option>
            <option value="squash_flavors">Squash Flavors</option>
          </select>
        </div>
        <div class="form-group">
          <label for="item-unit">Unit</label>
          <select id="item-unit" name="unit" required>
            <option value="">Select Unit</option>
            <option value="gram">Gram</option>
            <option value="milliliter">Milliliter</option>
            <option value="piece">Piece</option>
          </select>
        </div>
        <div class="form-group">
          <label for="item-current">Current Quantity</label>
          <input type="number" id="item-current" name="current_quantity" min="0" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="item-minimum">Minimum Quantity</label>
          <input type="number" id="item-minimum" name="minimum_quantity" min="0" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="item-notes">Notes (Reason)</label>
          <textarea id="item-notes" name="notes" rows="3" placeholder="Reason for stock opname (e.g., audit correction, shrinkage)"></textarea>
        </div>
        <div class="form-actions">
          <button type="submit" class="save-button">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Change Status Confirmation Modal -->
  <div id="change-status-modal" class="modal hidden">
    <div class="modal-content delete-confirm-modal">
      <button class="modal-close" id="close-change-status-modal">
        &times;
      </button>
      <div class="modal-header">
        <i class="fas fa-exclamation-triangle warning-icon"></i>
        <h3 class="modal-title">Warning</h3>
      </div>
      <div class="modal-body">
        <p class="item-name" id="change-status-item-name"></p>
        <p>Current Availability: <span id="current-availability"></span></p>
        <div class="radio-group" style="display: inline-flex; gap: 15px; align-items: center; margin: 1rem 0;">
          <div class="radio-option" style="display: flex; align-items: center;">
            <input type="radio" id="is-avail-true" name="is-avail" value="true">
            <label for="is-avail-true">Available</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="is-avail-false" name="is-avail" value="false">
            <label for="is-avail-false">Unavailable</label>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <!-- <button type="button" class="modal-btn modal-btn-cancel" id="cancel-change-status-btn">Cancel</button> -->
        <button type="button" class="save-button" id="confirm-change-status-btn">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Add Stock Modal -->
  <div id="add-stock-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Add Stock</h3>
        <button class="modal-close" id="close-add-stock-modal">
          &times;
        </button>
      </div>
      <form id="add-stock-form">
        <div class="form-group">
          <label for="stock-ingredient">Select Ingredient</label>
          <select id="stock-ingredient" name="ingredient_id" required>
            <option value="">Select Ingredient</option>
          </select>
        </div>
        <div class="form-group">
          <label for="stock-quantity">Quantity to Add</label>
          <input type="number" id="stock-quantity" name="quantity" min="0" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="stock-notes">Notes (Reason)</label>
          <textarea id="stock-notes" name="notes" rows="3" placeholder="Add any notes about this stock addition..."></textarea>
        </div>
        <div class="form-actions">
          <button type="submit" class="save-button">Add Stock</button>
        </div>
      </form>
    </div>
  </div>



  <script src="script.js"></script>
  <script src="js/kelola-stok.js"></script>
</body>
</html>